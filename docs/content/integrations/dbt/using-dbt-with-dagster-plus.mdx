---
title: "Guide: Using dbt with Dagster+"
description: Deploy your dbt & Dagster project in Dagster+.
---

# Guide: Using dbt with Dagster+

<Note>
  <strong>Note</strong>: This guide focuses on serverless deployments in
  Dagster+. For more information about hybrid deployments, visit this{" "}
  <a href="/dagster-plus/deployment/hybrid#hybrid-deployments-in-dagster">
    guide
  </a>
  .
</Note>

This guide helps you getting started with dbt in Dagster+. Importing an existing dbt project in Dagster+ allows you to automatically load your dbt models as Dagster assets. This can be be done with an existing dbt project, that is not already using Dagster, or a Dagster project in which your dbt project is included.

## Import your dbt project to Dagster+

Using Dagster+ Serverless, importing a dbt project to create a new Dagster project and deploy your code location is as easy as it gets. After browsing to Deployment > Code Locations > Add code location, choosing the option "Import a dbt project" allows you to import the Git repo of your dbt project.

<!--
![Import a dbt project in Dagster+](/images/integrations/dbt/using-dbt-with-dagster-plus/import_dbt_project.png)
-->

<Image
src="/images/integrations/dbt/using-dbt-with-dagster-plus/import_dbt_project.png"
width={2248}
height={1530}
/>

### Example: import a dbt project from a GitHub repo

Importing a dbt project can be done in a few steps only. Using GitHub to select the repository of a dbt project and deploy it to Dagster+ is a very common use case. Let's walk through the steps.

After clicking on "Continue" on the main page of "Import a dbt project", you'll be prompted to connect with either GitHub or GitLab. For this example, let's select GitHub.

This action will redirect you to the GitHub website, where you'll be asked to authorize the Dagster+ application. Keep in mind that the profile or organization authorizing Dagster+ should have the read and write access for the repository containing the dbt project to be imported.

<!--
![Connect to GitHub to import a dbt project in Dagster+](/images/integrations/dbt/using-dbt-with-dagster-plus/import_dbt_project_connect_to_git.png)
-->

<Image
src="/images/integrations/dbt/using-dbt-with-dagster-plus/import_dbt_project_connect_to_git.png"
width={2168}
height={830}
/>

#### Select and deploy the repo

Once the authorization completed, search the repositories and select the one containing the dbt project to be imported.

Before continuing, make sure that the repository is a valid dbt project - the [dbt_project.yml](https://docs.getdbt.com/reference/dbt_project.yml) and [profiles.yml](https://docs.getdbt.com/docs/core/connect-data-platform/profiles.yml) files are required for the deployment process. An error message will be displayed if these files are missing.

When the correct repository is selected, click "Continue". Note that this process will update your repository by opening a new pull request, which will contain the Dagster files required to deploy the dbt project to Dagster+.

<!--
![Select the repository of a dbt project in Dagster+](/images/integrations/dbt/using-dbt-with-dagster-plus/import_dbt_project_select_repo.png)
-->

<Image
src="/images/integrations/dbt/using-dbt-with-dagster-plus/import_dbt_project_select_repo.png"
width={2166}
height={1492}
/>

#### Review the state of the repo

When deploying a dbt project for the first time, the workflow uses the `dagster-dbt scaffold` command to create a Dagster project matching the dbt one. Once this process is completed, the workflow opens a pull request in the repository so that you can review the newly generated code and merge it to the production branch.

This process updates the file structure of the repository. let's take a look at the differences before and after the changes.

Before the changes, a typical dbt project would include files like dbt_project.yml, profiles.yml, dbt models in `.sql` format and sbt seeds in `.csv` format. Considering that this is a Git repository, other files may be included, like `.gitignore`, `LICENSE` and `README.md`.

```shell
my_dbt_project
├── models
│   ├── my_model.sql
├── seeds
│   ├── my_seeds.csv
├── .gitignore
├── LICENSE
├── README.md
├── dbt_project.yml
└── profiles.yml
```

After the changes, new files and folders are added to the repository. A [dagster_cloud.yaml file](/dagster-plus/managing-deployments/dagster-cloud-yaml) is added, which defines your code location for Dagster+. Two cloud action files are added under `.github/workflows`, `branch_deployments.yml` and `deploy.yml`, to manage the deployments of the repository. last but not least, all the Dagster files are added in a folder named after your repository. These are mostly Python files and add the required code base to run your dbt project with Dagster.

```shell
my_dbt_project
├── .github
│   ├── workflows
│   │   ├── branch_deployments.yml
│   │   ├── deploy.yml
├── models
│   ├── my_model.sql
├── my_dbt_project
│   ├── my_dbt_project
│   │   ├── __init__.py
│   │   ├── assets.py
│   │   ├── definitions.py
│   │   ├── project.py
│   │   ├── schedules.py
│   ├── pyproject.toml
│   ├── setup.py
├── seeds
│   ├── my_seeds.csv
├── .gitignore
├── LICENSE
├── README.md
├── dagster_cloud.yaml
├── dbt_project.yml
└── profiles.yml
```

## Import your dbt & Dagster project to Dagster+

If a Dagster project already created for your dbt project, you may want to import it directly in Dagster+. After browsing to Deployment > Code Locations > Add code location, choosing the option "Import a Dagster project" allows you to import the Git repo of your dbt & Dagster project.

<Note>
  To find out more about integrating dbt in a Dagster project, begin the
  official{" "}
  <a href="/integrations/dbt/using-dbt-with-dagster">
    [dbt scaffold tutorial](/integrations/dbt/using-dbt-with-dagster)
  </a>
  .
</Note>

<!--
![Import a dbt project in Dagster+](/images/integrations/dbt/using-dbt-with-dagster-plus/import_dagster_project.png)
-->

<Image
src="/images/integrations/dbt/using-dbt-with-dagster-plus/import_dagster_project.png"
width={2248}
height={1000}
/>

### Example: import a dbt & Dagster project from a GitHub repo

Importing a dbt & Dagster project is quick and easy using the "Import a Dagster project" option. Let's look at how to do it using GitHub.

On the main page of "Import a Dagster project", you can choose to connect to GitHub or GitLab. For this example, let's select GitHub.

This action will redirect you to the GitHub website, where you'll be asked to authorize the Dagster+ application. Keep in mind that the profile or organization authorizing Dagster+ should have the read and write access for the repository containing the dbt & Dagster project to be imported.

#### Select and deploy the repo

Once the authorization completed, search the repositories and select the one containing the dbt & Dagster project to be imported.

Before continuing, make sure that the repository contains the required files for dbt and Dagster. For dbt, the [dbt_project.yml](https://docs.getdbt.com/reference/dbt_project.yml) and [profiles.yml](https://docs.getdbt.com/docs/core/connect-data-platform/profiles.yml) files are required for the deployment process. For Dagster, your project requires a `pyproject.toml` file with the information about where to find your Dagster definitions. For more information about the `pyproject.toml` file, read our [guide about code locations](/concepts/code-locations).

When the correct repository is selected, click "Continue". Note that this process will update your repository by adding directly new files to your default branch.

<!--
![Select the repository of a dbt & Dagster project in Dagster+](/images/integrations/dbt/using-dbt-with-dagster-plus/import_dagster_project_select_repo.png)
-->

<Image
src="/images/integrations/dbt/using-dbt-with-dagster-plus/import_dagster_project_select_repo.png"
width={2166}
height={1120}
/>

#### Update the cloud action files

When importing a project in Dagster+ using the "Import a Dagster Project" feature, various files are added to the repository containing the project, including the cloud action files. These files are optimized for general use in Dagster projects, but require some attention when the Dagster project includes a dbt component. Once these files are updated, the dbt & Dagster project will be successfully deployed to Dagster+.

Follow these steps to update the cloud action files. Note that in this example, the dbt project directory in the repository is called `dbt` and the [adapter used by dbt](https://docs.getdbt.com/docs/connect-adapters) is DuckDB. Depending on your dbt & Dagster project, you might need to update the code.

1. In your Dagster project, locate the `.github/workflows` directory.

2. Open the `deploy.yml` file.

3. Locate the Checkout for Python Executable Deploy step, which should be on or near line 38.

4. Add

```
- name: Parse dbt project and package with Dagster project
  if: steps.prerun.outputs.result == 'pex-deploy'
  run: |
    pip install pip --upgrade
    pip install dbt-duckdb
    cd project-repo/dbt
    dbt deps
    dbt parse
  shell: bash
```

5. Open the `branch_deployments.yml` file, then repeat steps 3 and 4.

#### Review the state of the repo

When deploying a Dagster project for the first time, the workflow adds various files - a [dagster_cloud.yaml file](/dagster-plus/managing-deployments/dagster-cloud-yaml), if it is missing, and two cloud action files under `.github/workflows`, `branch_deployments.yml` and `deploy.yml`, to manage the deployments of the repository.

After adding the files to the repository, a typical file structure would include the required files for dbt and Dagster, some files related to Git, like `.gitignore`, and the newly added files.

```shell
my_dbt_and_dagster_project
├── .github
│   ├── workflows
│   │   ├── branch_deployments.yml
│   │   ├── deploy.yml
├── dbt
│   ├── models
│   │   ├── my_model.sql
│   ├── seeds
│   │   ├── my_seeds.csv
│   ├── dbt_project.yml
│   ├── profiles.yml
├── my_dbt_and_dagster_project
│   ├── __init__.py
│   ├── assets.py
│   ├── definitions.py
│   ├── project.py
│   ├── schedules.py
├── .gitignore
├── LICENSE
├── README.md
├── dagster_cloud.yaml
├── pyproject.toml
└── setup.py
```

## Understanding the cloud action files

The cloud action files added to your repository when importing a project are essential - they manage the deployments in Dagster+. While the files added through the "Import a dbt project" workflow are ready to use as-is, those added through the "Import a Dagster project" workflow requires some attention when importing a dbt & Dagster project. Let's take a closer look at the differences between the files and the required steps for when using dbt in a Dagster project.

For this exercise, let's consider the `deploy.yml` file added when importing a project from a GitHub repository. This guide will focus on the steps using the fast deployment with Python EXecutable (PEX). For more details about this approach, visit our [serverless deployment guide](/dagster-plus/deployment/serverless#customizing-the-runtime-environment).

The content of the `deploy.yml` file varies according to the import workflow that was selected - the [one added via "Import a dbt project"](https://github.com/dagster-io/dagster-cloud-action/blob/v0.1.40/github/serverless/dbt/deploy.yml) contains steps that are specific to dbt, while [the one added via "Import a Dagster project"](https://github.com/dagster-io/dagster-cloud-action/blob/v0.1.40/github/serverless/deploy.yml) is missing the required steps for dbt since it is the basic template for all Dagster projects. This being said, the latter can easily be updated to work with a project using dbt.

### Shared steps

The `deploy.yml` file includes steps that are required to deploy a project in Dagster+, whether the project is using dbt or not. These steps include running checks before the run, checking out the directory where the content of the project repository is, and deploying the project using PEX.

The first two steps are straightforward and self-explanatory. After the prerun checks are completed, the project repository is checked out before any other actions are taken.

```
- name: Prerun Checks
  id: prerun
  uses: dagster-io/dagster-cloud-action/actions/utils/prerun@v0.1

- name: Checkout
  if: steps.prerun.outputs.result == 'pex-deploy'
  uses: actions/checkout@v3
  with:
    ref: ${{ github.head_ref }}
    path: project-repo
```

Once these steps are done, the following step will build and deploy the content of the project, according to the provided configurations.

```
- name: Python Executable Deploy
  if: steps.prerun.outputs.result == 'pex-deploy'
  uses: dagster-io/dagster-cloud-action/actions/build_deploy_python_executable@v0.1
  with:
    dagster_cloud_file: "$GITHUB_WORKSPACE/project-repo/$DAGSTER_CLOUD_FILE"
    build_output_dir: "$GITHUB_WORKSPACE/build"
    python_version: "${{ env.PYTHON_VERSION }}"
  env:
    GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

### Steps specific to dbt

<Note>
  <strong>Note</strong>: This guide uses the command <code>dagster-dbt project prepare-for-deployment</code>,
  which uses the experimental class <code>DbtProject</code>. Visit the{" "}
  <a href="/\_apidocs/libraries/dagster-dbt#dagster_dbt.DbtProject">
    dagster-dbt library API reference
  </a>{" "}
  for more info.
</Note>

When it comes to Dagster projects using dbt, more steps are required to deploying successfully to Dagster+.

The first two steps are more straightforward then the third one - one validates the configuration and the other initializes the CI.

```
- name: Validate configuration
  id: ci-validate
  if: steps.prerun.outputs.result == 'pex-deploy'
  uses: dagster-io/dagster-cloud-action/actions/utils/dagster-cloud-cli@v0.1
  with:
    command: "ci check --project-dir project-repo --dagster-cloud-yaml-path ${{ env.DAGSTER_CLOUD_FILE }}"

- name: Initialize build session
  id: ci-init
  if: steps.prerun.outputs.result == 'pex-deploy'
  uses: dagster-io/dagster-cloud-action/actions/utils/ci-init@v0.1
  with:
    project_dir: project-repo
    dagster_cloud_yaml_path: ${{ env.DAGSTER_CLOUD_FILE }}
    deployment: 'prod'
```

Once theses steps are completed, it is time to prepare the dbt project for deployment. This step uses the `dagster-dbt project prepare-for-deployment` command, which will find the `DbtProject` objects in your project and run each `manifest_preparer`. This ensures that `manifest.json` exists and can be found at the expected path when the dbt assets are created. For more information about `DbtProject` and its manifest_preparer`, visit the [dagster-dbt library API reference](/\_apidocs/libraries/dagster-dbt#dagster_dbt.DbtProject).

```
- name: Prepare DBT project for deployment
  if: steps.prerun.outputs.result == 'pex-deploy'
  # --upgrade-strategy eager picks up newer packages that are required for things to work
  run: |
    pip install pip --upgrade
    cd project-repo/${{ env.DAGSTER_PROJECT_NAME }}
    pip install . --upgrade --upgrade-strategy eager
    dagster-dbt project prepare-for-deployment --file ${{ env.DAGSTER_PROJECT_NAME }}/project.py
    # The cli command below can be used to manage syncing the prod manifest to branches if state_path is set on the DbtProject
    # dagster-cloud ci dagster-dbt project manage-state --file ${{ env.DAGSTER_PROJECT_NAME }}/project.py
  shell: bash
```


## What's next

For an end-to-end example, from the project creation to the deployment to Dagster+, checkout out the Dagster & dbt course in [Dagster University](https://courses.dagster.io).